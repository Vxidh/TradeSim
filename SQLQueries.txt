SQL Queries for TradeSim (executed on Neon's console):

1)
SELECT
  a.ticker,
  SUM(t.quantity * t.price) AS total_volume
FROM trades t
JOIN assets a ON t.asset_id = a.asset_id
GROUP BY a.ticker
ORDER BY total_volume DESC;

2)
WITH RankedTrades AS (
  SELECT
    t.trade_id,
    a.ticker,
    t.price,
    t.executed_at,
    ROW_NUMBER() OVER(
      PARTITION BY a.asset_id, DATE(t.executed_at)
      ORDER BY t.executed_at ASC
    ) as rn
  FROM trades t
  JOIN assets a ON t.asset_id = a.asset_id
)
SELECT ticker, price, executed_at
FROM RankedTrades
WHERE rn = 1;

3)

CREATE TABLE IF NOT EXISTS trade_audit_log (
  log_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  trade_id BIGINT,
  action_type VARCHAR(10) NOT NULL,
  action_timestamp TIMESTAMPTZ DEFAULT NOW()
);


CREATE OR REPLACE FUNCTION log_new_trade()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO trade_audit_log(trade_id, action_type)
  VALUES(NEW.trade_id, 'INSERT');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;


DROP TRIGGER IF EXISTS new_trade_trigger ON trades;
CREATE TRIGGER new_trade_trigger
AFTER INSERT ON trades
FOR EACH ROW
EXECUTE FUNCTION log_new_trade();